import{at as ie,x as Te,w as n,l as de,au as Be,av as He,e as Ke,f as qe,aw as We,j as e,S as ae,U as Pe,ax as Ge,z as Q,a7 as h,a0 as te,ac as H,B as w,a8 as q,ay as ce,a9 as L,G as le,az as me,aA as ue,aB as Se,aC as pe,E as De,aD as Ye,aE as _e,aF as he,aG as ge,aH as ne,aa as xe,aI as Ce,aJ as be,ad as Xe,aK as Je,aL as Ze,ae as ye,aM as Qe,aN as ea,aO as Re,aP as aa,aQ as ta,aR as na,aS as sa,aT as oa,aj as la,D as ra,aU as ca,aV as ia}from"./vendor-BlYRANeV.js";import{bq as ma,br as Ae,T as da}from"./index-B3vXDUsi.js";import{h as Ne,s as P,u as ua,B as pa}from"./index-BCqpSD-Y.js";import{a as Le,i as ha,b as ga,v as se,c as xa,d as Ca,e as ba,f as ze}from"./config-De6rmCc8.js";const fa=p=>{const{delElement:t,copyElement:a,pastElement:v,undo:o}=ma();ie(["ctrl.c","meta.c"],m=>{["INPUT","TEXTAREA"].includes(m.target.tagName)||a()}),ie(["ctrl.v","meta.v"],m=>{["INPUT","TEXTAREA"].includes(m.target.tagName)||v()}),ie(["ctrl.z","meta.z"],m=>{["INPUT","TEXTAREA"].includes(m.target.tagName)||m.target.contentEditable==="true"||o()}),ie(["delete","backspace"],m=>{["INPUT","TEXTAREA"].includes(m.target.tagName)||m.target.contentEditable==="true"||t()})},ve=Te({editMyApplicationApi:{method:"put",url:"/myApps"},getPageList:{url:"/page/list"},getPageDetail:{url:"/page/detail"},getAppListList:{url:"/project/appList"},saveAppDesign:{url:"/myApps/saveDesign",method:"put"},getApiList:{url:"/dataSource/otherPage"},addApiItem:{url:"/dataSource/otherApi",method:"post"},saveAppSetting:{url:"/myApps/saveAppRouteAuth",method:"put"},getAppVersionList:{url:"/project/publishList/:id"},getAppLogList:{url:"/myApps/changeLog"},publishApi:{method:"post",url:"/myApps/publish"},getLastPublishContentApi:{method:"get",url:"/myApps/lastPublishContent"},getAppType:{method:"GET",url:"/tag/getAppType/:category"},triggerPackage:{method:"GET",url:"/myApps/triggerPackage"},getPackageResult:{method:"GET",url:"/myApps/packageResult",timeout:0},getIconList:{url:"/resourceInfo/page"},getProjectInfoApi:{method:"get",url:"/project"},getAllSystemConfigApi:{url:"/sysConfig/getConfigMap"},getCurrentEditUserApi:{url:"/myApps/isEdit"},edit:{url:"/myApps/edit"},exitEdit:{url:"/myApps/exitEdit",method:"delete"},initApp:{url:"/myApps/init"}},{baseUrl:"/microApp",headers:{"Content-Type":"application/json"},timeout:1e4});function ja(){n.useEffect(()=>{const p=t=>{t.preventDefault(),t.returnValue=""};return window.addEventListener("beforeunload",p),()=>{window.removeEventListener("beforeunload",p)}},[])}de.extend(Be);de.extend(He);function wa(p){const{setHideCenter:t,hideCenter:a,setSelectedElement:v,clearPageInfo:o,getApisList:m,resetPageInfo:c,setIcons:l,setImages:i}=window.usePageStore(S=>{var u,x,f;const N=S.page[((u=S.selectPageItem)==null?void 0:u.id)||""]||{};return{getApisList:S.getApisList,setHideCenter:S.setHideCenter,theme:(f=(x=N.config)==null?void 0:x.props)==null?void 0:f.theme,clearPageInfo:S.clearPageInfo,setSelectedElement:S.setSelectedElement,resetPageInfo:S.resetPageInfo,setIcons:S.setIcons,setImages:S.setImages,hideCenter:S.hideCenter}}),[r,s]=n.useState(!1);fa(),ja();function b(){window.React=window.React||Pe,window.dayjs=window.dayjs||de,window.antd=window.antd||Ge}const{pathname:z}=Ke();return qe(async()=>{b(),z.includes("/editor/edit")&&m();const{pathname:S}=window.location;if(S.startsWith("/microAppsWeb")){const N=await ve.getProjectInfoApi().catch(C=>{console.warn(C.message)}),u={pageNum:1,pageSize:1e3,type:Ne.ICON};N!=null&&N.id&&(u.projectId=N.id);const x=await ve.getIconList(u);l((x==null?void 0:x.data)||[]),u.type=Ne.PICTURE;const f=await ve.getIconList(u);i((f==null?void 0:f.data)||[])}}),n.useEffect(()=>{if(!a){s(!0);const S=setTimeout(()=>{s(!1),clearTimeout(S)},32)}},[a]),We(()=>{Object.keys(Ae).forEach(S=>{Reflect.deleteProperty(Ae,S)}),t(!1),o(),v(void 0),c()}),e.jsx(e.Fragment,{children:r?e.jsx(ae,{className:"z-2 h-[calc(100vh-64px)] w-full grid place-items-center",spinning:r}):p.children})}const Sa="/app/assets/png/banner-BpyfT4JC.png",ya="/app/assets/png/defaultAvatar-hZrzV3KK.png",va={oldPassword:"",newPassword:"",newPasswordRepeat:""},Ma=({mRef:p})=>{const{t}=Q(),a=window.$message,[v]=h.useForm(),[o,m]=n.useState(!1),[c,l]=n.useState(!1),i=()=>{l(!0),m(!1),v.resetFields()};n.useImperativeHandle(p,()=>({open:i}));const r=()=>{l(!1),m(!1)},s=async()=>{const z=await v.validateFields().catch(S=>{console.log("form validate fail",S)});if(z){m(!0);try{await P.personalCenterEditPasswordApi(z)}catch(S){console.log("edit password api failed",S),m(!1);return}a.success(t("buComp.authManagement.reviseSuccess")),m(!1),l(!1)}},b=(z,S)=>v.getFieldValue("newPassword")===S?Promise.resolve():Promise.reject(t("buComp.authManagement.passwordNotSame"));return e.jsx(te,{width:"620px",title:t("buComp.authManagement.revisePassword"),open:c,onCancel:r,confirmLoading:o,footer:e.jsxs(H,{className:"pl-5 pr-5",justify:"flex-end",align:"center",gap:"middle",children:[e.jsx(w,{onClick:r,children:t("buComp.common.cancel")},"back"),e.jsx(w,{onClick:s,type:"primary",children:t("buComp.common.confirm")},"save")]}),children:e.jsxs(h,{className:"p-5",form:v,initialValues:va,layout:"vertical",children:[e.jsx(h.Item,{name:"oldPassword",label:t("buComp.authManagement.oldPassword"),rules:[{required:!0,message:t("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+t("buComp.authManagement.oldPassword",{lowerCase:!0})}],children:e.jsx(q.Password,{placeholder:t("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+t("buComp.authManagement.oldPassword",{lowerCase:!0}),allowClear:!0})}),e.jsx(h.Item,{name:"newPassword",label:t("buComp.authManagement.newPassword"),rules:[{required:!0,message:t("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+t("buComp.authManagement.newPassword",{lowerCase:!0})},{validator:Le}],children:e.jsx(q.Password,{placeholder:t("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+t("buComp.authManagement.newPassword",{lowerCase:!0}),allowClear:!0})}),e.jsx(h.Item,{name:"newPasswordRepeat",label:t("buComp.authManagement.confirmPassword"),rules:[{required:!0,message:t("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+t("buComp.authManagement.confirmPassword",{lowerCase:!0})},{validator:b}],children:e.jsx(q.Password,{placeholder:t("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+t("buComp.authManagement.confirmPassword",{lowerCase:!0}),allowClear:!0})})]})})},ka=()=>{const{useToken:p}=le,{token:t}=p(),a=window.$translation,v=window.$modal,o=window.$message,[m,c]=n.useState(!1),[l,i]=n.useState(void 0),{username:r,avatar:s,phone:b,name:z,email:S,roleIds:N,deptName:u,postName:x,roleNames:f}=l||{},[C,g]=n.useState(0),[d,B]=n.useState(!1),[y,E]=n.useState(!1),[T,I]=n.useState(""),[k,K]=n.useState(""),V=n.useRef(),D=async()=>{c(!0);let U;try{U=await P.personalCenterGetApi()}catch(Y){console.log("personal center get api failed",Y),c(!1);return}const W=new Date().getTime(),X=new Date(U.createdAt).getTime();g(Math.floor((W-X)/(1e3*60*60*24))),i(U),c(!1)};n.useEffect(()=>{D()},[]);const O=()=>{I(b||""),B(!0)},G=async()=>{c(!0);try{await P.personalCenterEditPhoneApi({phone:T})}catch(U){console.log("edit phone api failed",U),c(!1);return}c(!1),o.success(a("common.fdb.editSuccess")),B(!1),await D()},R=()=>{if(!ha(T)){o.error(a("buComp.authManagement.phoneRule"));return}v.confirm({title:a("buComp.common.revise"),content:a("buComp.authManagement.confirmRevisePhone"),okText:a("buComp.common.confirm"),cancelText:a("buComp.common.cancel"),okType:"primary",centered:!0,onOk:()=>G()})},A=()=>{K(S||""),E(!0)},j=async()=>{c(!0);try{await P.personalCenterEditEmailApi({email:k})}catch(U){console.log("edit emial api failed",U),c(!1);return}c(!1),o.success(a("common.fdb.editSuccess")),E(!1),await D()},$=()=>{if(!ga(k)){o.error(a("buComp.authManagement.emailRule"));return}v.confirm({title:a("buComp.common.revise"),content:a("buComp.authManagement.confirmReviseEmail"),okText:a("buComp.common.confirm"),cancelText:a("buComp.common.cancel"),okType:"primary",centered:!0,onOk:()=>j()})},_=async U=>{const W=["image/jpeg","image/png","image/svg+xml","image/webp"].includes(U.type);W||o.error(a("buComp.authManagement.onlyPic"));const X=U.size/1024/1024<2;if(X||o.error(a("buComp.authManagement.smallerThan2M")),W&&X){c(!0);const Y=new FormData;Y.append("avatar",U);try{await P.personalCenterAvatarApi(Y)}catch{return console.log("avatar api failed"),c(!1),!1}o.success(a("buComp.common.fdb.uploadSuccess")),c(!1),D()}return!1};return e.jsxs(ae,{spinning:m,wrapperClassName:"spin-loading",children:[e.jsxs("div",{className:"min-w-1000px min-h-800px w-full h-full builtInPersonalCenter",children:[e.jsxs(H,{align:"center",justify:"space-between",className:"p-inline-50px overflow-hidden text-white chint-theme-container h-164px!",style:{backgroundImage:`url(${Sa})`,backgroundSize:"cover",letterSpacing:"2px"},children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-34px font-bold h-45px lh-24px",children:["Hello, ",r||""]}),e.jsx("div",{className:"mt-10px h-21px lh-24px",children:a("buComp.authManagement.welcomeText")})]}),e.jsxs("div",{className:"lh-24px",children:[e.jsx("span",{className:"text-20px",children:a("buComp.authManagement.hasUsedSystem")}),e.jsx("span",{className:"text-34px font-bold ml-5px mr-5px",children:C}),e.jsx("span",{className:"text-20px",children:a("buComp.authManagement.day")})]})]}),e.jsxs(H,{className:"mt-20px w-100% p-inline-35px p-block-30px chint-theme-container",style:{height:"calc(100% - 184px)",backgroundColor:t.colorBgContainer,color:t.colorText},children:[e.jsxs(H,{vertical:!0,align:"center",className:"w-20% h-100%",children:[e.jsxs("div",{className:"w-140px h-140px mt-40px position-relative",children:[e.jsx("img",{src:s?"/microApp/static"+s:ya,className:"object-contain w-100% h-100% rd-100%",style:{border:`1px solid ${t.colorBorder}`}}),e.jsx(ce,{accept:"image/jpeg, image/png, image/svg+xml, image/webp",showUploadList:!1,maxCount:1,beforeUpload:_,children:e.jsx(w,{className:"position-absolute bottom-0 right-0 z-11",icon:e.jsx(L,{name:"bi"}),type:"primary",shape:"circle"})})]}),e.jsx("div",{className:"mt-20px line-height-24px text-16px",style:{color:t.colorTextBase},children:r||"XXX"}),e.jsxs("div",{className:"mt-10px text-14px line-height-24px",style:{color:t.colorTextDescription},children:[u||"",e.jsx("span",{className:"ml-5px"}),x||""]}),e.jsxs(H,{vertical:!0,gap:30,className:"mt-30px text-14px",children:[e.jsxs(H,{align:"start",children:[e.jsx(L,{className:"mt-5px",name:"bumen"}),e.jsxs("span",{className:"ml-12px",children:[a("buComp.authManagement.department")," :",e.jsx("span",{className:"ml-5px",children:u||""})]})]}),e.jsxs(H,{align:"start",children:[e.jsx(L,{className:"mt-5px",name:"gangwei"}),e.jsxs("span",{className:"ml-12px",children:[a("buComp.authManagement.post")," :",e.jsx("span",{className:"ml-5px",children:x||""})]})]}),e.jsxs(H,{align:"start",children:[e.jsx(L,{className:"mt-5px",name:"jiaose"}),e.jsxs(H,{wrap:!0,className:"ml-12px",children:[e.jsxs("span",{className:"mr-5px",children:[a("buComp.authManagement.role")," :"]}),(f==null?void 0:f.map((U,W)=>e.jsx("span",{className:"mr-10px",children:U},N==null?void 0:N[W])))||""]})]})]})]}),e.jsxs("div",{className:"pl-100px h-100% w-80% text-14px",children:[e.jsx("div",{className:"h-56px line-height-56px w-100%",style:{boxShadow:"inset 0px -1px 0px rgba(112,112,112,0.5)",color:t.colorTextBase},children:a("buComp.authManagement.accountInfo")}),e.jsxs("div",{children:[e.jsxs(H,{className:"mt-20px",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-30px line-height-30px",children:a("buComp.authManagement.username")}),e.jsx("div",{className:"mt-10px w-240px h-30px lh-30px value",children:r||""})]}),e.jsxs("div",{className:"w-240px ml-70px",children:[e.jsx("div",{className:"h-30px line-height-30px",children:a("buComp.authManagement.password")}),e.jsx(w,{type:"primary",className:"mt-10px h-30px line-height-30px",onClick:()=>{var U;return(U=V.current)==null?void 0:U.open()},children:a("buComp.common.revise")})]})]}),e.jsxs(H,{className:"mt-30px",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-30px line-height-30px",children:a("buComp.authManagement.name")}),e.jsx("div",{className:"mt-10px w-240px h-30px line-height-30px value",children:z||""})]}),e.jsxs("div",{className:"ml-70px",children:[e.jsx("div",{className:"h-30px line-height-30px",children:a("buComp.authManagement.phone")}),e.jsx("div",{className:"mt-10px flex",children:d?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-240px h-30px line-height-30px",value:T,onChange:U=>I(U.target.value)}),e.jsx(w,{type:"primary",className:"ml-15px h-30px",onClick:R,children:a("buComp.common.confirm")}),e.jsx(w,{onClick:()=>{B(!1)},type:"primary",className:"ml-15px h-30px",children:a("buComp.common.cancel")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-240px h-30px line-height-30px value",children:b||""}),e.jsx(w,{type:"primary",className:"ml-15px h-30px",onClick:O,children:a("buComp.common.revise")})]})})]})]}),e.jsxs("div",{className:"mt-30px",children:[e.jsx("div",{className:"h-30px line-height-30px",children:a("buComp.authManagement.department")}),e.jsx("div",{className:"mt-10px w-550px h-30px line-height-30px value",children:u||""})]}),e.jsxs(H,{className:"mt-30px",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-30px line-height-30px",children:a("buComp.authManagement.role")}),e.jsx("div",{className:"mt-10px w-240px min-h-30px line-height-30px value",children:(f==null?void 0:f.map((U,W)=>e.jsx("span",{className:"mr-10px",children:U},N==null?void 0:N[W])))||""})]}),e.jsxs("div",{className:"ml-70px",children:[e.jsx("div",{className:"h-30px line-height-30px",children:a("buComp.authManagement.post")}),e.jsx("div",{className:"mt-10px w-240px h-30px line-height-30px value",children:x||""})]})]}),e.jsxs("div",{className:"mt-30px",children:[e.jsx("div",{className:"h-30px line-height-30px",children:a("buComp.authManagement.email")}),e.jsx("div",{className:"mt-10px flex",children:y?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-550px h-30px line-height-30px text-16px",value:k,onChange:U=>K(U.target.value)}),e.jsx(w,{type:"primary",className:"ml-15px h-30px",onClick:$,children:a("buComp.common.confirm")}),e.jsx(w,{onClick:()=>{E(!1)},type:"primary",className:"ml-15px h-30px",children:a("buComp.common.cancel")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-550px h-30px line-height-30px value",children:S||""}),e.jsx(w,{type:"primary",className:"ml-15px h-30px",onClick:A,children:a("buComp.common.revise")})]})})]})]})]})]})]}),e.jsx(Ma,{mRef:V})]})};var oe=(p=>(p.UNLOCK="0",p.LOCK="9",p))(oe||{});const Fe=[{label:"buComp.authManagement.all",value:"0"},{label:"buComp.authManagement.custom",value:"1"},{label:"buComp.authManagement.currentAndBelow",value:"2"},{label:"buComp.authManagement.current",value:"3"},{label:"buComp.authManagement.person",value:"4"}];var Me=(p=>(p[p.CATALOG=0]="CATALOG",p[p.MENU=1]="MENU",p[p.BUTTON=2]="BUTTON",p))(Me||{});const Ia={username:"",name:"",roleIds:[],deptId:void 0,postId:void 0,password:"",phone:"",email:"",lockFlag:oe.UNLOCK},Aa=({mRef:p,onUpdate:t})=>{const{t:a}=Q(),v=window.$message,[o]=h.useForm(),[m,c]=n.useState(!1),[l,i]=n.useState(!1),[r,s]=n.useState(!1),[b,z]=n.useState([]),[S,N]=n.useState([]),[u,x]=n.useState([]),f=async y=>{s(!0);let E;try{E=await P.userGetApi({$id:y})}catch(T){console.log("user get api failed",T),s(!1);return}if(E){let T=[];const I=await P.deptGetApi({$id:E.deptId}).catch(k=>{console.log("dept get api failed",k)});I&&(T=I.treePath),o.setFieldsValue({...E,deptId:T})}s(!1)},C=y=>{var E;return{value:y.id,label:y.name,children:(E=y.children)==null?void 0:E.map(T=>C(T))}},g=async({id:y})=>{i(!0),c(!!y),o.resetFields(),s(!0);const E=await P.deptListApi().catch(k=>{console.log("dept list api failed",k)});z((E==null?void 0:E.map(k=>C(k)))||[]);const T=await P.postListApi().catch(k=>{console.log("post list api failed",k)});N((T==null?void 0:T.map(k=>({value:k.id,label:k.postName})))||[]);const I=await P.roleListApi().catch(k=>{console.log("role list api failed",k)});x((I==null?void 0:I.map(k=>({value:k.id,label:k.roleName})))||[]),s(!1),y&&(o.setFieldValue("id",y),await f(y))};n.useImperativeHandle(p,()=>({open:g}));const d=()=>{i(!1),s(!1)},B=async()=>{const y=await o.validateFields().catch(T=>{console.log("form validate fail",T)});if(!y)return;s(!0);const E={username:y.username,name:y.name,roleIds:y.roleIds,deptId:y.deptId[y.deptId.length-1],postId:y.postId,password:y.password,phone:y.phone,email:y.email,lockFlag:y.lockFlag};if(m){E.id=o.getFieldValue("id");try{await P.userEditApi(E)}catch(T){console.log("user edit api fail",T),s(!1);return}v.success(a("buComp.authManagement.editSuccess"))}else{try{await P.userAddApi(E)}catch(T){console.log("user add api fail",T),s(!1);return}v.success(a("buComp.authManagement.addSuccess"))}s(!1),i(!1),t()};return e.jsx(te,{width:"390px",classNames:{content:"h-460px",body:"h-330px overflow-auto pr-18px!"},title:a(m?"buComp.common.edit":"buComp.common.create"),open:l,onCancel:d,footer:e.jsxs(H,{justify:"flex-end",align:"center",gap:"small",children:[e.jsx(w,{onClick:d,children:a("buComp.common.cancel")}),e.jsx(w,{onClick:B,type:"primary",children:a("buComp.common.confirm")})]}),children:e.jsx(ae,{spinning:r,wrapperClassName:"spin-loading",children:e.jsxs(h,{form:o,initialValues:m?void 0:Ia,layout:"vertical",children:[e.jsx(h.Item,{name:"username",label:a("buComp.authManagement.username"),rules:[{required:!0,message:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.username",{lowerCase:!0})},{min:6,max:20,message:a("buComp.authManagement.lengthRule",{min:6,max:20})},{validator:se}],children:e.jsx(q,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.username",{lowerCase:!0}),allowClear:!0})}),e.jsx(h.Item,{name:"name",label:a("buComp.authManagement.name"),rules:[{required:!0,message:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.name",{lowerCase:!0})},{min:2,max:10,message:a("buComp.authManagement.lengthRule",{min:2,max:10})},{validator:se},{validator:xa}],children:e.jsx(q,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.name",{lowerCase:!0}),allowClear:!0})}),e.jsx(h.Item,{name:"roleIds",label:a("buComp.authManagement.role"),rules:[{required:!0,message:a("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+a("buComp.authManagement.role",{lowerCase:!0})}],children:e.jsx(me,{mode:"multiple",optionFilterProp:"label",allowClear:!0,placeholder:a("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+a("buComp.authManagement.role",{lowerCase:!0}),options:u})}),e.jsx(h.Item,{name:"deptId",label:a("buComp.authManagement.department"),rules:[{required:!0,message:a("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+a("buComp.authManagement.department",{lowerCase:!0})}],children:e.jsx(ue,{allowClear:!0,placeholder:a("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+a("buComp.authManagement.department",{lowerCase:!0}),options:b,changeOnSelect:!0})}),e.jsx(h.Item,{name:"postId",label:a("buComp.authManagement.post"),rules:[{required:!0,message:a("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+a("buComp.authManagement.post",{lowerCase:!0})}],children:e.jsx(me,{allowClear:!0,placeholder:a("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+a("buComp.authManagement.post",{lowerCase:!0}),options:S})}),!m&&e.jsx(h.Item,{name:"password",label:a("buComp.authManagement.password"),rules:[{required:!0,message:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.password",{lowerCase:!0})},{min:8,max:20,message:a("buComp.authManagement.lengthRule",{min:8,max:20})},{validator:se},{validator:Le}],children:e.jsx(q.Password,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.password",{lowerCase:!0}),allowClear:!0})}),e.jsx(h.Item,{name:"phone",label:a("buComp.authManagement.phone"),rules:[{validator:Ca}],children:e.jsx(q,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.phone",{lowerCase:!0}),allowClear:!0})}),e.jsx(h.Item,{name:"email",label:a("buComp.authManagement.email"),rules:[{validator:ba}],children:e.jsx(q,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.email",{lowerCase:!0}),allowClear:!0})}),e.jsx(h.Item,{name:"lockFlag",label:a("buComp.common.enable"),rules:[{required:!0,message:a("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+a("buComp.common.enable",{lowerCase:!0})}],children:e.jsxs(Se.Group,{children:[e.jsx(Se,{value:oe.UNLOCK,children:a("buComp.common.enable")}),e.jsx(Se,{value:oe.LOCK,children:a("buComp.common.disable")})]})})]})})})},Na=({mRef:p,onUpdate:t})=>{const a=window.$translation,[v,o]=n.useState(!1),[m,c]=n.useState(!1);n.useImperativeHandle(p,()=>({open(){o(!0)}}));const l=async()=>{console.log("submit"),t()},i=()=>{o(!1),c(!1)},r=b=>{console.log("change",b)},s=b=>{console.log("drop",b)};return e.jsx(te,{width:"390px",title:a("buComp.common.import"),open:v,onCancel:i,confirmLoading:m,footer:e.jsxs(H,{justify:"flex-end",align:"center",gap:"small",children:[e.jsx(w,{onClick:i,children:a("buComp.common.cancel")},"back"),e.jsx(w,{onClick:l,type:"primary",children:a("buComp.common.confirm")},"save")]}),children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"c-red-600",children:"*"}),e.jsx("span",{children:a("buComp.authManagement.onlyXls")}),e.jsx(w,{color:"primary",variant:"link",children:a("buComp.authManagement.downloadTemplate")})]}),e.jsx("div",{children:e.jsxs(ce.Dragger,{name:"file",maxCount:1,showUploadList:{showRemoveIcon:!0,showDownloadIcon:!0},accept:"application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:r,onDrop:s,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(pe,{})}),e.jsx("p",{children:a("buComp.authManagement.uploadTip")})]})})]})})},Ea={password:""},Ta=({mRef:p,onUpdate:t})=>{const{t:a}=Q(),v=window.$message,[o]=h.useForm(),[m,c]=n.useState(!1),[l,i]=n.useState(!1),r=({id:x})=>{c(!0),o.resetFields(),o.setFieldValue("id",x)};n.useImperativeHandle(p,()=>({open:r}));const s=()=>{c(!1),i(!1)},b=async()=>{const x=await o.validateFields().catch(C=>{console.log("form validate fail",C)});if(!x)return;i(!0);const f={id:o.getFieldValue("id"),password:x.password};try{await P.userChangePasswordApi(f)}catch{console.log("user change password api failed"),i(!1);return}v.success(a("buComp.authManagement.editSuccess")),i(!1),c(!1),t()},z=x=>/^\s*$/.test(x),S=(x,f,C)=>{f.length&&z(f)&&C(a("buComp.authManagement.noAllBlank")),C()},N=(x,f)=>/^[a-zA-Z0-9\\W_!@#$%^&*`~()-+=]*$/.test(f)?/^(?![a-zA-Z]+$)(?![A-Z0-9]+$)(?![A-Z\\W_!@#$%^&*`~()-+=]+$)(?![a-z0-9]+$)(?![a-z\\W_!@#$%^&*`~()-+=]+$)(?![0-9\\W_!@#$%^&*`~()-+=]+$)[a-zA-Z0-9\\W_!@#$%^&*`~()-+=]*$/.test(f)?Promise.resolve():Promise.reject(a("buComp.authManagement.passwordRule")):Promise.reject(a("buComp.authManagement.passwordCantUseChar")),u=(x,f)=>o.getFieldValue("password")===f?Promise.resolve():Promise.reject(a("buComp.authManagement.passwordNotSame"));return e.jsx(te,{width:"390px",title:a("buComp.authManagement.resetPassword"),open:m,onCancel:s,confirmLoading:l,footer:e.jsxs(H,{justify:"flex-end",align:"center",gap:"small",children:[e.jsx(w,{onClick:s,children:a("buComp.common.cancel")},"back"),e.jsx(w,{onClick:b,type:"primary",children:a("buComp.common.confirm")},"save")]}),children:e.jsxs(h,{form:o,initialValues:Ea,layout:"vertical",children:[e.jsx(h.Item,{name:"password",label:a("buComp.authManagement.password"),rules:[{required:!0,message:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.password",{lowerCase:!0})},{min:8,max:20,message:a("buComp.authManagement.lengthRule",{min:8,max:20})},{validator:S},{validator:N}],children:e.jsx(q.Password,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.password",{lowerCase:!0}),allowClear:!0})}),e.jsx(h.Item,{name:"passwordRepeat",label:a("buComp.authManagement.confirmPassword"),rules:[{required:!0,message:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.confirmPassword",{lowerCase:!0})},{validator:u}],children:e.jsx(q.Password,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.confirmPassword",{lowerCase:!0}),allowClear:!0})})]})})},fe=function(p,t){return p?de(p).format(t):""},Pa=()=>{const{token:p}=le.useToken(),{t}=Q(),a=window.$message,v=window.$modal,[o,m]=n.useState(!1),[c]=h.useForm(),l={deptId:void 0,roleId:void 0,name:void 0},i=n.useRef({deptId:void 0,roleId:void 0,name:void 0}),[r,s]=n.useState([]),b=n.useRef(),z=n.useRef(),S=n.useRef(),[N,u]=n.useState([]),[x,f]=n.useState([]),[C,g]=n.useState([]),[d,B]=n.useState({current:1,pageSize:10,total:0}),[y,E]=n.useState("calc(100% - 112px)"),[T,I]=n.useState(900),k=n.useRef(),K=n.useRef(),V={selectedRowKeys:r,onChange:M=>{s(M)},columnWidth:50},D=async(M,F)=>{m(!0);const Z={pageNum:M,pageSize:F,...i.current},Ue=await P.userPageApi(Z).catch(ee=>{console.log("get user list api fail",ee)}),{data:we,pageNum:ke,pageSize:Ie,totalSize:Ve}=Ue||{};u((we==null?void 0:we.map((ee,Oe)=>({id:ee.id,index:(ke-1)*Ie+Oe+1,userName:ee.username,name:ee.name,phone:ee.phone,department:ee.deptName,role:ee.roleNames,post:ee.postName,status:ee.lockFlag,createTime:ee.createdAt})))||[]),B({current:ke||M,pageSize:Ie||F,total:Ve||0}),m(!1)},O=async(M,F)=>{try{await P.userChangeStatusApi({ids:[M],lockFlag:F?oe.UNLOCK:oe.LOCK})}catch(Z){console.log("user change status api failed",Z);return}a.success(t("buComp.authManagement.actionSuccess")),D(d.current,d.pageSize)},G=(M,F)=>{v.confirm({title:t(F?"buComp.common.enable":"buComp.common.disable"),content:e.jsxs(e.Fragment,{children:[F?t("buComp.authManagement.confirmEnable",{addSpaceAfterEn:!0}):t("buComp.authManagement.confirmDisable",{addSpaceAfterEn:!0}),M.name,"?"]}),okText:t("buComp.common.confirm"),cancelText:t("buComp.common.cancel"),okType:"primary",centered:!0,onOk:()=>O(M.id,F)})},R=async()=>{try{await P.userChangeStatusApi({ids:r,lockFlag:oe.UNLOCK})}catch(M){console.log("user change status api failed",M);return}a.success(t("buComp.authManagement.actionSuccess")),D(d.current,d.pageSize),s([])},A=()=>{v.confirm({title:t("buComp.common.batch",{addSpaceAfterEn:!0})+t("buComp.common.enable",{lowerCase:!0}),content:e.jsxs(e.Fragment,{children:[t("buComp.authManagement.confirmEnable",{addSpaceAfterEn:!0}),t("buComp.authManagement.xUsers",{number:r.length}),"?"]}),okText:t("buComp.common.confirm"),cancelText:t("buComp.common.cancel"),okType:"primary",centered:!0,onOk:()=>R()})},j=async M=>{try{await P.userDeleteApi({ids:[M]})}catch(F){console.log("delete user api failed",F);return}a.success(t("buComp.authManagement.deleteSuccess")),D(N.length===1&&d.current>1?d.current-1:d.current,d.pageSize)},$=M=>{v.confirm({title:t("buComp.common.delete"),content:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:t("buComp.authManagement.confirmDelete",{addSpaceAfterEn:!0})+M.name+"?"}),e.jsx("div",{style:{color:p.colorError},children:t("buComp.authManagement.deleteTips")})]}),okText:t("buComp.common.confirm"),cancelText:t("buComp.common.cancel"),okType:"primary",centered:!0,onOk:()=>j(M.id)})},_=async()=>{try{await P.userDeleteApi({ids:r})}catch(M){console.log("delete user api failed",M);return}a.success(t("buComp.authManagement.deleteSuccess")),D(N.length===r.length&&d.current>1&&d.total<=d.current*d.pageSize?d.current-1:d.current,d.pageSize)},U=()=>{v.confirm({title:t("buComp.common.batchDelete"),content:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:t("buComp.authManagement.confirmDelete",{addSpaceAfterEn:!0})+t("buComp.authManagement.xUsers",{number:r.length})+"?"}),e.jsx("div",{style:{color:p.colorError},children:t("buComp.authManagement.deleteTips")})]}),okText:t("buComp.common.confirm"),cancelText:t("buComp.common.cancel"),okType:"primary",centered:!0,onOk:()=>_()})},W=[{title:t("buComp.authManagement.index"),dataIndex:"index",width:80},{title:t("buComp.authManagement.username"),dataIndex:"userName",width:150},{title:t("buComp.authManagement.name"),dataIndex:"name",width:130},{title:t("buComp.authManagement.phone"),dataIndex:"phone",width:150},{title:t("buComp.authManagement.department"),dataIndex:"department",width:120},{title:t("buComp.authManagement.role"),dataIndex:"role",width:260,render:M=>e.jsx("div",{className:"flex gap-5px items-center flex-wrap",children:M.map(F=>e.jsx(De,{theme:{components:{Tag:{defaultBg:"#3C414C",defaultColor:"#999999"}}},children:e.jsx(Ye,{color:"default",children:F})},F))})},{title:t("buComp.authManagement.post"),dataIndex:"post",width:125},{title:t("buComp.authManagement.status"),dataIndex:"status",width:130,render:(M,F)=>e.jsxs(H,{align:"center",children:[e.jsx(_e,{onChange:Z=>{G(F,Z)},checked:M===oe.UNLOCK})," ",e.jsx("span",{children:M===oe.LOCK?t("buComp.common.disable"):t("buComp.common.enable")})]})},{title:t("buComp.authManagement.createTime"),dataIndex:"createTime",width:200,render:M=>fe(M,"YYYY-MM-DD HH:mm:ss")},{title:t("buComp.authManagement.action"),width:150,render:(M,F)=>e.jsx(he,{sameProps:{type:"text",size:"small"},tileCount:2,btnPermissions:["auth","edit","delete"],btnList:[{title:t("buComp.authManagement.resetPassword"),resCode:"auth",icon:e.jsx(L,{name:"yonghuquanxian"}),onClick:()=>{var Z;return(Z=S.current)==null?void 0:Z.open({id:F.id})}},{title:t("buComp.common.edit"),resCode:"edit",icon:e.jsx(L,{name:"bi"}),onClick:()=>{var Z;return(Z=b.current)==null?void 0:Z.open({id:F.id})}},{title:t("buComp.common.delete"),resCode:"delete",icon:e.jsx(L,{name:"shanchu"}),onClick:()=>$(F)}],record:F})}],X=()=>{c.resetFields(),i.current={...l},D(1,d.pageSize),s([])},Y=()=>{const M=c.getFieldsValue();i.current={...M,deptId:M.deptId?M.deptId[M.deptId.length-1]:void 0},D(1,d.pageSize)},J=M=>{var F;return{value:M.id,label:M.name,children:(F=M.children)==null?void 0:F.map(Z=>J(Z))}},re=async()=>{const M=await P.deptListApi().catch(F=>{console.log("dept list api failed",F)});f((M==null?void 0:M.map(F=>J(F)))||[])},je=async()=>{const M=await P.roleListApi().catch(F=>{console.log("role list api failed",F)});g((M==null?void 0:M.map(F=>({label:F.roleName,value:F.id})))||[])};return n.useEffect(()=>{D(1,10),re(),je();const M=()=>{const F=setTimeout(()=>{var Z;E(`calc(100% - ${((Z=k==null?void 0:k.current)==null?void 0:Z.clientHeight)||70}px)`),clearTimeout(F)},100)};return M(),window.addEventListener("resize",M),()=>window.removeEventListener("resize",M)},[]),n.useEffect(()=>{var M;I((((M=K.current)==null?void 0:M.clientHeight)||900)-50)},[y]),e.jsxs(ae,{spinning:o,wrapperClassName:"spin-loading",children:[e.jsxs("div",{className:"p-20px w-full h-full chint-theme-container",style:{backgroundColor:p.colorBgContainer},children:[e.jsx("div",{ref:k,children:e.jsxs(h,{form:c,initialValues:l,children:[e.jsxs(ge,{align:"middle",gutter:[24,12],wrap:!0,children:[e.jsx(ne,{span:6,children:e.jsx(h.Item,{name:"deptId",label:t("buComp.authManagement.department"),children:e.jsx(ue,{options:x,allowClear:!0,placeholder:t("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+t("buComp.authManagement.department",{lowerCase:!0})})})}),e.jsx(ne,{span:6,children:e.jsx(h.Item,{name:"roleId",label:t("buComp.authManagement.role"),children:e.jsx(me,{options:C,allowClear:!0,placeholder:t("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+t("buComp.authManagement.role",{lowerCase:!0})})})}),e.jsx(ne,{span:6,children:e.jsx(h.Item,{name:"name",label:t("buComp.authManagement.name"),children:e.jsx(q,{allowClear:!0,placeholder:t("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+t("buComp.authManagement.name",{lowerCase:!0})})})}),e.jsx(ne,{span:6,children:e.jsxs(xe,{size:16,children:[e.jsx(h.Item,{children:e.jsx(w,{type:"primary",onClick:Y,icon:e.jsx(L,{name:"chaxun"}),children:t("buComp.common.search")})}),e.jsx(h.Item,{children:e.jsx(w,{onClick:X,icon:e.jsx(L,{name:"zhongzhi"}),children:t("buComp.common.reset")})})]})})]}),e.jsxs(H,{align:"center",gap:"middle",wrap:!0,children:[e.jsx(h.Item,{children:e.jsx(w,{type:"primary",onClick:()=>{var M;(M=b.current)==null||M.open({})},icon:e.jsx(L,{name:"xinzeng"}),children:t("buComp.common.create")})}),e.jsx(h.Item,{children:e.jsx(w,{type:"primary",onClick:A,disabled:r.length===0,icon:e.jsx(L,{name:"qiyong"}),children:t("buComp.common.batch",{addSpaceAfterEn:!0})+t("buComp.common.enable",{lowerCase:!0})})}),e.jsx(h.Item,{children:e.jsx(w,{type:"primary",onClick:U,disabled:r.length===0,danger:!0,icon:e.jsx(L,{name:"shanchu"}),children:t("buComp.common.batchDelete")})})]})]})}),e.jsxs("div",{className:"w-100% overflow-auto",style:{height:y},children:[e.jsx(Ce,{style:{height:"calc(100% - 50px)"},columns:W,dataSource:N,rowSelection:V,rowKey:"id",scroll:{y:T,x:"900px"},pagination:!1,ref:K}),e.jsx(be,{className:"mt-10px h-40px",showQuickJumper:!0,showSizeChanger:!0,current:d.current,pageSize:d.pageSize,total:d.total,hideOnSinglePage:!1,pageSizeOptions:[10,20,30,50,100],onChange:D,showTotal:(M,F)=>t("common.paginationTotal",{rangeStart:F[0],rangeEnd:F[1],total:M}),align:"center"})]})]}),e.jsx(Aa,{mRef:b,onUpdate:X}),e.jsx(Na,{mRef:z,onUpdate:X}),e.jsx(Ta,{mRef:S,onUpdate:X})]})},Da={roleName:"",roleCode:"",dsType:void 0,roleDesc:""},Ra=({mRef:p,onUpdate:t})=>{const{t:a}=Q(),v=window.$message,[o]=h.useForm(),[m,c]=n.useState(!1),[l,i]=n.useState(!1),[r,s]=n.useState(!1),b=async u=>{s(!0);let x;try{x=await P.roleGetApi({$id:u})}catch(f){console.log("get role get api fail",f),s(!1);return}x&&o.setFieldsValue(x),s(!1)},z=async({id:u})=>{i(!0),c(!!u),o.resetFields(),u&&(o.setFieldValue("id",u),await b(u))};n.useImperativeHandle(p,()=>({open:z}));const S=()=>{i(!1),c(!1),s(!1),o.resetFields()},N=async()=>{const u=await o.validateFields().catch(f=>{console.log("form validate fail",f)});if(!u)return;s(!0);const x={roleName:u.roleName,roleCode:u.roleCode,dsType:u.dsType,roleDesc:u.roleDesc};if(m){x.id=o.getFieldValue("id");try{await P.roleEditApi(x)}catch(f){console.log("role edit api fail",f),s(!1);return}v.success(a("buComp.authManagement.editSuccess"))}else{try{await P.roleAddApi(x)}catch(f){console.log("role add api fail",f),s(!1);return}v.success(a("buComp.authManagement.addSuccess"))}s(!1),i(!1),t()};return e.jsx(te,{width:"390px",classNames:{content:"h-460px",body:"h-330px overflow-auto pr-18px!"},title:a(m?"buComp.common.edit":"buComp.common.create"),open:l,onCancel:S,footer:e.jsxs(H,{justify:"flex-end",align:"center",gap:"small",children:[e.jsx(w,{onClick:S,children:a("buComp.common.cancel")}),e.jsx(w,{onClick:N,type:"primary",children:a("buComp.common.confirm")})]}),children:e.jsx(ae,{spinning:r,wrapperClassName:"spin-loading",children:e.jsxs(h,{form:o,initialValues:m?void 0:Da,layout:"vertical",children:[e.jsx(h.Item,{name:"roleName",label:a("buComp.authManagement.roleName"),rules:[{required:!0,message:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.roleName",{lowerCase:!0})},{max:20,message:a("buComp.authManagement.lengthMax",{number:20})},{validator:se}],children:e.jsx(q,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.roleName",{lowerCase:!0}),allowClear:!0})}),e.jsx(h.Item,{name:"roleCode",label:a("buComp.authManagement.roleIdentifier"),rules:[{required:!0,message:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.roleIdentifier",{lowerCase:!0})},{max:50,message:a("buComp.authManagement.lengthMax",{number:50})},{validator:se},{validator:ze}],children:e.jsx(q,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.roleIdentifier",{lowerCase:!0}),allowClear:!0})}),e.jsx(h.Item,{name:"dsType",label:a("buComp.authManagement.dataAuth"),rules:[{required:!0,message:a("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+a("buComp.authManagement.dataAuth",{lowerCase:!0})}],children:e.jsx(me,{allowClear:!0,placeholder:a("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+a("buComp.authManagement.dataAuth",{lowerCase:!0}),options:Fe.map(u=>({label:a(u.label),value:u.value}))})}),e.jsx(h.Item,{name:"roleDesc",label:a("buComp.authManagement.roleDesc"),rules:[{max:200,message:a("buComp.authManagement.lengthMax",{number:200})}],children:e.jsx(q,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.roleDesc",{lowerCase:!0}),allowClear:!0})})]})})})},La=({mRef:p,onUpdate:t})=>{const a=window.$translation,[v,o]=n.useState(!1),[m,c]=n.useState(!1);n.useImperativeHandle(p,()=>({open(){o(!0)}}));const l=async()=>{console.log("submit"),t()},i=()=>{o(!1),c(!1)},r=b=>{console.log("change",b)},s=b=>{console.log("drop",b)};return e.jsx(te,{width:"390px",title:a("buComp.common.import"),open:v,onCancel:i,confirmLoading:m,footer:e.jsxs(H,{justify:"flex-end",align:"center",gap:"small",children:[e.jsx(w,{onClick:i,children:a("buComp.common.cancel")},"back"),e.jsx(w,{onClick:l,type:"primary",children:a("buComp.common.confirm")},"save")]}),children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"c-red-600",children:"*"}),e.jsx("span",{children:a("buComp.authManagement.onlyXls")}),e.jsx(w,{color:"primary",variant:"link",children:a("buComp.authManagement.downloadTemplate")})]}),e.jsx("div",{children:e.jsxs(ce.Dragger,{name:"file",maxCount:1,showUploadList:{showRemoveIcon:!0,showDownloadIcon:!0},accept:"application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:r,onDrop:s,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(pe,{})}),e.jsx("p",{children:a("buComp.authManagement.uploadTip")})]})})]})})},za=({mRef:p,onUpdate:t})=>{const a=window.$translation,[v,o]=n.useState(!1),[m,c]=n.useState(!1),l=n.useRef(0),[i,r]=n.useState({checked:[],halfChecked:[]}),[s,b]=n.useState([]),[z,S]=n.useState(!1),[N,u]=n.useState(!1),x=n.useRef([]),f=I=>{var k;return x.current.push(I.id),{title:I.name,key:I.id,children:(k=I.children)==null?void 0:k.map(K=>f(K)),type:I.type}},C=async({id:I})=>{o(!0),c(!0),l.current=I;let k;try{k=await P.menuListApi()}catch(V){console.log("menu list api failed",V);return}b(k.map(V=>f(V)).reverse());const K=await P.authMenuApi({$id:I}).catch(V=>{console.log("auth menu api failed",V)});r({checked:K||[],halfChecked:[]}),c(!1)};n.useImperativeHandle(p,()=>({open:C}));const g=()=>{o(!1),c(!1),l.current=0},d=async()=>{c(!0);try{await P.authRoleApi({id:l.current,menuIds:[...i.checked,...i.halfChecked]})}catch(I){console.log("auth role api failed",I);return}o(!1),c(!1),t()},B=(I,k,K)=>{let V=k;return I.forEach(D=>{D.type!==Me.BUTTON&&(K&&!V.includes(D.key)?V.push(D.key):V=V.filter(O=>O!==D.key),D.children&&(V=B(D.children,V,K)))}),V},y=(I,k,K)=>{const V=[];K.reduce((O,G,R)=>R===0||R===K.length-1?O:(V.push(O[G]),O[G].children||[]),s);const D=I;return V.reverse().forEach(O=>{k?(O.children||[]).every(G=>D.checked.includes(G.key))?D.checked.push(O.key):D.halfChecked.includes(O.key)||D.halfChecked.push(O.key):(D.checked.includes(O.key)&&(D.checked=D.checked.filter(G=>G!==O.key)),(O.children||[]).some(G=>D.checked.includes(G.key))?D.halfChecked.includes(O.key)||D.halfChecked.push(O.key):D.halfChecked=D.halfChecked.filter(G=>G!==O.key))}),D},E=(I,k)=>{if(Array.isArray(I))r({checked:I,halfChecked:[]});else{const K=B(k.node.children||[],I.checked,k.checked);if(k.node.type!==Me.BUTTON){const V=y({checked:K,halfChecked:I.halfChecked},k.checked,k.node.pos.split("-").map(D=>Number(D)));r(V)}else r({checked:K,halfChecked:I.halfChecked})}},T=I=>{const k=I.target.checked;r(k?{checked:x.current,halfChecked:[]}:{checked:[],halfChecked:[]}),S(k)};return n.useEffect(()=>{x.current.every(I=>i.checked.includes(I))?(S(!0),u(!1)):(S(!1),i.checked.length>0?u(!0):u(!1))},[i.checked]),e.jsx(te,{width:"390px",classNames:{content:"h-460px",body:"h-330px overflow-auto pr-18px!"},title:a("buComp.common.auth"),open:v,onCancel:g,confirmLoading:m,footer:e.jsxs(H,{justify:"flex-end",align:"center",gap:"small",children:[e.jsx(w,{onClick:g,children:a("buComp.common.cancel")},"back"),e.jsx(w,{onClick:d,type:"primary",children:a("buComp.common.confirm")},"save")]}),children:e.jsxs("div",{className:"roleManagementAuthTree",children:[e.jsx(Xe,{checked:z,onChange:T,indeterminate:N,children:a("common.selectAll")}),e.jsx(De,{theme:{token:{colorBgContainer:"transparent"}},children:e.jsx(Je,{checkable:!0,autoExpandParent:!0,selectable:!1,checkedKeys:i,onCheck:E,treeData:s,checkStrictly:!0})})]})})},Fa=()=>{const{token:p}=le.useToken(),{t}=Q(),a=window.$message,v=window.$modal,[o,m]=n.useState(!1),[c]=h.useForm(),l={roleName:void 0},i=n.useRef({roleName:void 0}),[r,s]=n.useState([]),b=n.useRef(),z=n.useRef(),S=n.useRef(),[N,u]=n.useState([]),[x,f]=n.useState({current:1,pageSize:10,total:0}),[C,g]=n.useState("calc(100% - 112px)"),[d,B]=n.useState(900),y=n.useRef(),E=n.useRef(),T={selectedRowKeys:r,onChange:A=>{s(A)},columnWidth:50},I=async(A,j)=>{m(!0);const $={pageNum:A,pageSize:j,...i.current},_=await P.rolePageApi($).catch(J=>{console.log("get post list api fail",J)}),{data:U,pageNum:W,pageSize:X,totalSize:Y}=_||{};u((U==null?void 0:U.map((J,re)=>({id:J.id,index:(W-1)*X+re+1,roleName:J.roleName,roleIdentifier:J.roleCode,roleDesc:J.roleDesc,dsType:J.dsType,createTime:J.createdAt})))||[]),f({current:W||A,pageSize:X||j,total:Y||0}),m(!1)},k=async A=>{try{await P.roleDeleteApi({ids:[A]})}catch(j){console.log("delete role api failed",j);return}a.success(t("buComp.authManagement.deleteSuccess")),I(N.length===1&&x.current>1?x.current-1:x.current,x.pageSize)},K=A=>{v.confirm({title:t("buComp.common.delete"),content:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:t("buComp.authManagement.confirmDelete",{addSpaceAfterEn:!0})+A.roleName+"?"}),e.jsx("div",{style:{color:p.colorError},children:t("buComp.authManagement.deleteTips")})]}),okText:t("buComp.common.confirm"),cancelText:t("buComp.common.cancel"),okType:"primary",centered:!0,onOk:()=>k(A.id)})},V=async()=>{try{await P.roleDeleteApi({ids:r})}catch(A){console.log("delete role api failed",A);return}a.success(t("buComp.authManagement.deleteSuccess")),I(N.length===r.length&&x.current>1&&x.total<=x.current*x.pageSize?x.current-1:x.current,x.pageSize)},D=()=>{v.confirm({title:t("buComp.common.batchDelete"),content:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:t("buComp.authManagement.confirmDelete",{addSpaceAfterEn:!0})+t("buComp.authManagement.xRoles",{number:r.length})+"?"}),e.jsx("div",{style:{color:p.colorError},children:t("buComp.authManagement.deleteTips")})]}),okText:t("buComp.common.confirm"),cancelText:t("buComp.common.cancel"),okType:"primary",centered:!0,onOk:()=>V()})},O=[{title:t("buComp.authManagement.index"),dataIndex:"index",width:80},{title:t("buComp.authManagement.roleName"),dataIndex:"roleName"},{title:t("buComp.authManagement.roleIdentifier"),dataIndex:"roleIdentifier"},{title:t("buComp.authManagement.roleDesc"),dataIndex:"roleDesc"},{title:t("buComp.authManagement.dataAuth"),dataIndex:"dsType",render:A=>{var j;return t(((j=Fe.find($=>$.value===A))==null?void 0:j.label)||"unknown")}},{title:t("buComp.authManagement.createTime"),dataIndex:"createTime",width:200,render:A=>fe(A,"YYYY-MM-DD HH:mm:ss")},{title:t("buComp.authManagement.action"),width:150,render:(A,j)=>e.jsx(he,{sameProps:{type:"text",size:"small"},tileCount:2,btnPermissions:["auth","edit","delete"],btnList:[{title:t("buComp.common.auth"),resCode:"auth",icon:e.jsx(L,{name:"yonghuquanxian"}),onClick:()=>{var $;return($=z.current)==null?void 0:$.open({id:j.id})}},{title:t("buComp.common.edit"),resCode:"edit",icon:e.jsx(L,{name:"bi"}),onClick:()=>{var $;return($=b.current)==null?void 0:$.open({id:j.id})}},{title:t("buComp.common.delete"),resCode:"delete",icon:e.jsx(L,{name:"shanchu"}),onClick:()=>K(j)}],record:j})}],G=()=>{const A=c.getFieldsValue();i.current=A,I(1,x.pageSize)},R=()=>{c.resetFields(),i.current=l,I(1,x.pageSize),s([])};return n.useEffect(()=>{I(1,10);const A=()=>{const j=setTimeout(()=>{var $;g(`calc(100% - ${(($=y.current)==null?void 0:$.clientHeight)||70}px)`),clearTimeout(j)},100)};return A(),window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)},[]),n.useEffect(()=>{var A;B((((A=E.current)==null?void 0:A.clientHeight)||900)-50)},[C]),e.jsx(ae,{spinning:o,wrapperClassName:"spin-loading",children:e.jsxs("div",{className:"p-20px w-full h-full chint-theme-container",style:{backgroundColor:p.colorBgContainer},children:[e.jsx("div",{ref:y,children:e.jsxs(h,{form:c,initialValues:l,children:[e.jsxs(ge,{align:"middle",gutter:[24,12],wrap:!0,children:[e.jsx(ne,{span:6,children:e.jsx(h.Item,{name:"roleName",label:t("buComp.authManagement.roleName"),children:e.jsx(q,{allowClear:!0,placeholder:t("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+t("buComp.authManagement.roleName",{lowerCase:!0})})})}),e.jsx(ne,{span:6,children:e.jsxs(xe,{size:16,children:[e.jsx(h.Item,{children:e.jsx(w,{type:"primary",onClick:G,icon:e.jsx(L,{name:"chaxun"}),children:t("buComp.common.search")})}),e.jsx(h.Item,{children:e.jsx(w,{onClick:R,icon:e.jsx(L,{name:"zhongzhi"}),children:t("buComp.common.reset")})})]})})]}),e.jsxs(H,{align:"center",gap:"middle",wrap:!0,children:[e.jsx(h.Item,{children:e.jsx(w,{type:"primary",onClick:()=>{var A;(A=b.current)==null||A.open({})},icon:e.jsx(L,{name:"xinzeng"}),children:t("buComp.common.create")})}),e.jsx(h.Item,{children:e.jsx(w,{type:"primary",onClick:D,disabled:r.length===0,danger:!0,icon:e.jsx(L,{name:"shanchu"}),children:t("buComp.common.batchDelete")})})]})]})}),e.jsxs("div",{className:"w-100%",style:{height:C,overflow:"auto"},children:[e.jsx(Ce,{style:{height:"calc(100% - 50px)"},columns:O,dataSource:N,rowSelection:T,rowKey:"id",scroll:{y:d,x:"900px"},pagination:!1,ref:E}),e.jsx(be,{className:"mt-10px h-40px",showQuickJumper:!0,showSizeChanger:!0,current:x.current,pageSize:x.pageSize,total:x.total,hideOnSinglePage:!1,pageSizeOptions:[10,20,30,50,100],onChange:I,showTotal:(A,j)=>t("common.paginationTotal",{rangeStart:j[0],rangeEnd:j[1],total:A}),align:"center"})]}),e.jsx(Ra,{mRef:b,onUpdate:R}),e.jsx(La,{mRef:S,onUpdate:R}),e.jsx(za,{mRef:z,onUpdate:R})]})})},$a=({tableData:p,pagination:t,onChangeSeletedRowKeys:a,onClickEdit:v,onUpdate:o,contentHeight:m})=>{const{token:c}=le.useToken(),{t:l}=Q(),i=window.$modal,r=window.$message,[s,b]=n.useState([]),[z,S]=n.useState(900),N=n.useRef(),u={selectedRowKeys:s,onChange:g=>{b(g),a(g)},columnWidth:50},x=async g=>{try{await P.deptDeleteApi({ids:[g]})}catch(d){console.log("delete dept api failed",d);return}r.success(l("buComp.authManagement.deleteSuccess")),o(p.length===1&&t.current>1?t.current-1:t.current,t.pageSize)},f=g=>{i.confirm({title:l("buComp.common.delete"),content:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:l("buComp.authManagement.confirmDelete",{addSpaceAfterEn:!0})+g.departmentName+"?"}),e.jsx("div",{style:{color:c.colorError},children:l("buComp.authManagement.deleteTips")})]}),okText:l("buComp.common.confirm"),cancelText:l("buComp.common.cancel"),okType:"primary",centered:!0,onOk:()=>x(g.id)})},C=[{title:l("buComp.authManagement.index"),dataIndex:"index",width:80},{title:l("buComp.authManagement.departmentName"),dataIndex:"departmentName"},{title:l("buComp.authManagement.order"),dataIndex:"order"},{title:l("buComp.authManagement.createTime"),dataIndex:"createTime",width:200,render:g=>fe(g,"YYYY-MM-DD HH:mm:ss")},{title:l("buComp.authManagement.action"),width:150,render:(g,d)=>e.jsx(he,{sameProps:{type:"text",size:"small"},tileCount:2,btnPermissions:["edit","delete"],btnList:[{title:l("buComp.common.edit"),resCode:"edit",icon:e.jsx(L,{name:"bi"}),onClick:()=>v(d.id)},{title:l("buComp.common.delete"),resCode:"delete",icon:e.jsx(L,{name:"shanchu"}),onClick:()=>f(d)}],record:d})}];return n.useEffect(()=>{var g;S((((g=N.current)==null?void 0:g.clientHeight)||900)-50)},[m]),e.jsxs(e.Fragment,{children:[e.jsx(Ce,{style:{height:"calc(100% - 50px)"},columns:C,dataSource:p,rowSelection:u,rowKey:"id",scroll:{y:z,x:"900px"},pagination:!1,ref:N}),e.jsx(be,{className:"h-40px mt-10px",showQuickJumper:!0,showSizeChanger:!0,current:t.current,pageSize:t.pageSize,total:t.total,hideOnSinglePage:!1,pageSizeOptions:[10,20,30,50,100],onChange:o,showTotal:(g,d)=>l("buComp.common.paginationTotal",{rangeStart:d[0],rangeEnd:d[1],total:g}),align:"center"})]})},Ee=({deptListData:p,companyName:t,onUpdate:a,setFullScreen:v,isFullScreen:o,onEdit:m})=>{const{token:c}=le.useToken(),{t:l}=Q(),i=window.$message,r=window.$modal,[s,b]=n.useState(100),z=n.useRef(null),S=n.useRef(0),N=n.useRef(0),[u,x]=n.useState({id:0,label:t||l("buComp.authManagement.headquarters")}),f=async y=>{try{await P.deptDeleteApi({ids:[y]})}catch(E){console.log("delete dept api failed",E);return}i.success(l("buComp.authManagement.deleteSuccess")),a()},C=y=>{r.confirm({title:l("buComp.common.delete"),content:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:l("buComp.authManagement.confirmDelete",{addSpaceAfterEn:!0})+y.name+"?"}),e.jsx("div",{style:{color:c.colorError},children:l("buComp.authManagement.deleteTips")})]}),okText:l("buComp.common.confirm"),cancelText:l("buComp.common.cancel"),okType:"primary",centered:!0,onOk:()=>f(y.id)})},g=(y,E)=>e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(w,{onClick:()=>{m({superiorId:E})},variant:"text",color:"default",children:l("buComp.authManagement.addDepartment")})}),e.jsx("div",{children:e.jsx(w,{onClick:()=>{m({id:y.id})},variant:"text",color:"default",children:l("buComp.authManagement.editDepartment")})}),e.jsx("div",{children:e.jsx(w,{onClick:()=>C(y),variant:"text",color:"default",children:l("buComp.authManagement.deleteDepartment")})})]}),d=(y,E)=>{var I;const T=[...E,y.id];return{id:y.id,label:e.jsx(ye,{content:g(y,T),children:y.name}),children:(I=y.children)==null?void 0:I.map(k=>d(k,T)),treePath:T,expand:y.children?!0:void 0}};n.useEffect(()=>{var y,E;x({id:0,label:e.jsx("div",{className:"text-20px",children:t===void 0||t===""?l("buComp.authManagement.headquarters"):t}),children:p.map(T=>d(T,[])),expand:!0}),S.current=(y=z.current)==null?void 0:y.clientHeight,N.current=(E=z.current)==null?void 0:E.clientWidth},[p]);const B=y=>{let E=s;y!==void 0?(E+=y,(E<10||E>300)&&(E=s)):E=100,b(E)};return e.jsxs("div",{className:"w-100% h-100%",style:{background:o?c.colorBgContainer:""},children:[e.jsx("div",{className:"overflow-auto pt-150px pb-150px w-100%",style:{height:"calc(100% - 60px)"},children:e.jsx("div",{style:{width:N.current*s/100+"px",height:S.current*s/100+"px"},children:e.jsx("div",{ref:z,style:{transform:`scale(${s}%)`,transformOrigin:"left top"},children:e.jsx(Ze,{horizontal:!1,collapsable:!0,expandAll:!0,data:u,labelClassName:"sceneTreeNode"})})})}),e.jsxs(H,{justify:"space-between",align:"center",gap:"10px",className:"position-absolute h-40px bottom-20px right-20px z-999",children:[e.jsx(ye,{content:l(o?"buComp.authManagement.quitFullScreen":"buComp.authManagement.fullScreen"),trigger:"hover",children:e.jsx(w,{type:"text",onClick:v,icon:e.jsx(L,{name:"quanping"})})}),e.jsx(Qe,{type:"vertical"}),e.jsx(ye,{content:l("buComp.common.reset"),trigger:"hover",children:e.jsx(w,{type:"text",onClick:()=>B(),icon:e.jsx(L,{name:"zhongzhi"})})}),e.jsx(w,{type:"text",icon:e.jsx(L,{name:"suoxiao"}),onClick:()=>B(-10)}),e.jsx("div",{className:"w-170px",children:e.jsx(ea,{value:s,onChange:b,min:10,max:300})}),e.jsx(w,{type:"text",icon:e.jsx(L,{name:"pilianghulve"}),onClick:()=>B(10)}),e.jsxs("span",{children:[s,"%"]})]})]})},Ua={treePath:void 0,name:"",order:0},Va=({mRef:p,onUpdate:t})=>{const{t:a}=Q(),v=window.$message,[o]=h.useForm(),[m,c]=n.useState(!1),[l,i]=n.useState(!1),[r,s]=n.useState(!1),[b,z]=n.useState([]),S=async C=>{s(!0);let g;try{g=await P.deptGetApi({$id:C})}catch(d){console.log("get post get api fail",d),s(!1);return}g&&(g.treePath?(g.treePath.pop(),g.treePath.length===0&&(g.treePath=[0])):g.treePath=[0],o.setFieldsValue(g)),s(!1)},N=C=>{var g;return{value:C.id,label:C.name,children:(g=C.children)==null?void 0:g.map(d=>N(d))}},u=async({id:C,superiorId:g})=>{i(!0),c(!!C),o.resetFields(),s(!0);const d=await P.deptListApi().catch(B=>{console.log("dept list api failed",B)});d&&z([{value:0,label:a("buComp.authManagement.noParentDept")},...d.map(B=>N(B))]),s(!1),C&&(o.setFieldValue("id",C),await S(C)),g&&o.setFieldValue("treePath",g)};n.useImperativeHandle(p,()=>({open:u}));const x=()=>{i(!1),s(!1)},f=async()=>{const C=await o.validateFields().catch(d=>{console.log("form validate fail",d)});if(!C)return;s(!0);const g={parentId:C.treePath[C.treePath.length-1],order:C.order,name:C.name};if(m){g.id=o.getFieldValue("id");try{await P.deptEditApi(g)}catch(d){console.log("post edit api fail",d),s(!1);return}v.success(a("buComp.authManagement.editSuccess"))}else{try{await P.deptAddApi(g)}catch(d){console.log("dept add api failed",d),s(!1);return}v.success(a("buComp.authManagement.addSuccess"))}t(),s(!1),i(!1)};return e.jsx(te,{width:"390px",classNames:{content:"h-460px",body:"h-330px overflow-auto pr-18px!"},title:a(m?"buComp.common.edit":"buComp.common.create"),open:l,onCancel:x,footer:e.jsxs(H,{justify:"flex-end",align:"center",gap:"small",children:[e.jsx(w,{onClick:x,children:a("buComp.common.cancel")}),e.jsx(w,{onClick:f,type:"primary",children:a("buComp.common.confirm")})]}),children:e.jsx(ae,{spinning:r,children:e.jsxs(h,{form:o,initialValues:m?void 0:Ua,layout:"vertical",children:[e.jsx(h.Item,{name:"treePath",label:a("buComp.authManagement.superiorDepartment"),rules:[{required:!0,message:a("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+a("buComp.authManagement.superiorDepartment",{lowerCase:!0})}],children:e.jsx(ue,{options:b,allowClear:!0,placeholder:a("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+a("buComp.authManagement.superiorDepartment",{lowerCase:!0}),changeOnSelect:!0})}),e.jsx(h.Item,{name:"name",label:a("buComp.authManagement.departmentName"),rules:[{required:!0,message:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.departmentName",{lowerCase:!0})},{max:20,message:a("buComp.authManagement.lengthMax",{number:20})},{validator:se}],children:e.jsx(q,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.departmentName",{lowerCase:!0}),allowClear:!0})}),e.jsx(h.Item,{name:"order",label:a("buComp.authManagement.order"),rules:[{required:!0,message:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.order",{lowerCase:!0})},{validator:se}],children:e.jsx(Re,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.order",{lowerCase:!0})})})]})})})},Oa=({mRef:p,onUpdate:t})=>{const a=window.$translation,[v,o]=n.useState(!1),[m,c]=n.useState(!1);n.useImperativeHandle(p,()=>({open(){o(!0)}}));const l=async()=>{console.log("submit"),t()},i=()=>{o(!1),c(!1)},r=b=>{console.log("change",b)},s=b=>{console.log("drop",b)};return e.jsx(te,{width:"390px",title:a("buComp.common.import"),open:v,onCancel:i,confirmLoading:m,footer:e.jsxs(H,{justify:"flex-end",align:"center",gap:"small",children:[e.jsx(w,{onClick:i,children:a("buComp.common.cancel")},"back"),e.jsx(w,{onClick:l,type:"primary",children:a("buComp.common.confirm")},"save")]}),children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"c-red-600",children:"*"}),e.jsx("span",{children:a("buComp.authManagement.onlyXls")}),e.jsx(w,{color:"primary",variant:"link",children:a("buComp.authManagement.downloadTemplate")})]}),e.jsx("div",{children:e.jsxs(ce.Dragger,{name:"file",maxCount:1,showUploadList:{showRemoveIcon:!0,showDownloadIcon:!0},accept:"application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:r,onDrop:s,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(pe,{})}),e.jsx("p",{children:a("buComp.authManagement.uploadTip")})]})})]})})},Ba=()=>{const{useToken:p}=le,{token:t}=p(),{t:a}=Q(),v=window.$modal,[o,m]=n.useState("list"),[c,l]=n.useState(!1),[i]=h.useForm(),r={search:void 0},s=n.useRef({search:void 0}),[b,z]=n.useState([]),[S,N]=n.useState([]),[u,x]=n.useState([]),[f,C]=n.useState({current:1,pageSize:10,total:0}),[g,d]=n.useState("calc(100% - 112px)"),[B,y]=n.useState(!1),E=n.useRef(),T=n.useRef(),I=n.useRef(),k=(j,$)=>{var _;return{id:j.id,index:$,departmentName:j.name,order:j.order,createTime:j.createAt,children:(_=j.children)==null?void 0:_.map((U,W)=>k(U,W+1))}},K=async(j,$)=>{l(!0);const _={pageNum:j,pageSize:$,...s.current},U=await P.deptPageApi(_).catch(re=>{console.log("get post list api fail",re)}),{data:W,pageNum:X,pageSize:Y,totalSize:J}=U||{};N((W==null?void 0:W.map((re,je)=>k(re,(X-1)*Y+je+1)))||[]),C({current:X||j,pageSize:Y||$,total:J||0}),l(!1)},V=async()=>{l(!0);const j=await P.deptListApi(s.current).catch($=>{console.log("dept list api failed",$)});x(j||[]),l(!1)},D=()=>{const j=i.getFieldsValue();s.current=j,K(1,f.pageSize),V()},O=()=>{i.resetFields(),s.current=r,z([]),K(1,f.pageSize),V()},G=()=>{m("list"),K(1,10),V()};n.useEffect(()=>{G();const j=()=>{const $=setTimeout(()=>{var _;d(`calc(100% - ${((_=E.current)==null?void 0:_.clientHeight)||70}px)`)},100);clearTimeout($)};return j(),window.addEventListener("resize",j),()=>window.removeEventListener("resize",j)},[]);const R=async()=>{try{await P.deptDeleteApi({ids:b})}catch(j){console.log("delete dept api failed",j);return}ta.success(a("buComp.authManagement.deleteSuccess")),await K(S.length===b.length&&f.current>1&&f.total<=f.current*f.pageSize?f.current-1:f.current,f.pageSize),await V()},A=()=>{v.confirm({title:a("buComp.common.batchDelete"),content:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:a("buComp.authManagement.confirmDelete",{addSpaceAfterEn:!0})+a("buComp.authManagement.xDepartments",{number:b.length})+"?"}),e.jsx("div",{style:{color:t.colorError},children:a("buComp.authManagement.deleteTips")})]}),okText:a("buComp.common.confirm"),cancelText:a("buComp.common.cancel"),okType:"primary",centered:!0,onOk:()=>R()})};return e.jsxs(ae,{spinning:c,wrapperClassName:"spin-loading",children:[e.jsxs("div",{className:"p-20px w-full h-full chint-theme-container",style:{background:t.colorBgContainer},children:[e.jsx("div",{ref:E,children:e.jsxs(h,{form:i,initialValues:r,children:[e.jsxs(ge,{align:"middle",gutter:[24,12],wrap:!0,children:[e.jsx(ne,{span:6,children:e.jsx(h.Item,{name:"search",label:a("buComp.authManagement.departmentName"),children:e.jsx(q,{allowClear:!0,placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.departmentName",{lowerCase:!0})})})}),e.jsx(ne,{span:6,children:e.jsxs(xe,{size:16,children:[e.jsx(h.Item,{children:e.jsx(w,{type:"primary",onClick:D,icon:e.jsx(L,{name:"chaxun"}),children:a("buComp.common.search")})}),e.jsx(h.Item,{children:e.jsx(w,{onClick:O,icon:e.jsx(L,{name:"zhongzhi"}),children:a("buComp.common.reset")})})]})})]}),e.jsxs(H,{justify:"space-between",align:"center",children:[e.jsxs(H,{gap:"middle",align:"center",wrap:!0,children:[e.jsx(h.Item,{children:e.jsx(w,{type:"primary",onClick:()=>{var j;(j=T.current)==null||j.open({})},icon:e.jsx(L,{name:"xinzeng"}),children:a("buComp.common.create")})}),e.jsx(h.Item,{children:o==="list"&&e.jsx(w,{type:"primary",onClick:A,disabled:b.length===0,danger:!0,icon:e.jsx(L,{name:"shanchu"}),children:a("buComp.common.batchDelete")})})]}),e.jsx(h.Item,{children:e.jsx(aa,{value:o,onChange:m,options:[{value:"list",icon:e.jsx(L,{name:"liebiao2"})},{value:"scene",icon:e.jsx(L,{name:"jiegoutu"})}]})})]})]})}),e.jsx("div",{className:"w-100% overflow-auto",style:{height:g},children:o==="list"?e.jsx($a,{tableData:S,pagination:f,onChangeSeletedRowKeys:z,onClickEdit:j=>{var $;return($=T.current)==null?void 0:$.open({id:j})},onUpdate:K,contentHeight:g}):e.jsx(Ee,{deptListData:u,onUpdate:V,setFullScreen:()=>y(j=>!j),isFullScreen:B,onEdit:j=>{var $;return($=T.current)==null?void 0:$.open(j)}})})]}),e.jsx(Va,{mRef:T,onUpdate:O}),e.jsx(Oa,{mRef:I,onUpdate:O}),B&&e.jsx("div",{className:"bg-white fixed top-0 bottom-0 left-0 right-0 z-999",children:e.jsx(Ee,{deptListData:u,onUpdate:V,companyName:a("buComp.authManagement.companyName"),setFullScreen:()=>y(j=>!j),isFullScreen:B,onEdit:j=>{var $;return($=T.current)==null?void 0:$.open(j)}})})]})},Ha={postName:"",postCode:"",deptTreePath:void 0,order:"",remark:""},Ka=({mRef:p,onUpdate:t})=>{const{t:a}=Q(),v=window.$message,[o]=h.useForm(),[m,c]=n.useState(!1),[l,i]=n.useState(!1),[r,s]=n.useState(!1),[b,z]=n.useState([]),S=async C=>{s(!0);let g;try{g=await P.postGetApi({$id:C})}catch(d){console.log("get post get api fail",d),s(!1);return}g&&o.setFieldsValue(g),s(!1)},N=C=>{var g;return{value:C.id,label:C.name,children:(g=C.children)==null?void 0:g.map(d=>N(d))}},u=async({id:C})=>{i(!0),c(!!C),s(!0),o.resetFields();const g=await P.deptListApi().catch(d=>{console.log("dept list api failed",d)});z((g==null?void 0:g.map(d=>N(d)))||[]),s(!1),C&&(o.setFieldValue("id",C),await S(C))};n.useImperativeHandle(p,()=>({open:u}));const x=()=>{i(!1),s(!1)},f=async()=>{const C=await o.validateFields().catch(d=>{console.log("form validate fail",d)});if(!C)return;s(!0);const g={deptId:C.deptTreePath[C.deptTreePath.length-1],postCode:C.postCode,postName:C.postName,remark:C.remark,order:C.order};if(m){g.id=o.getFieldValue("id");try{await P.postEditApi(g)}catch(d){console.log("post edit api fail",d),s(!1);return}v.success(a("buComp.authManagement.editSuccess"))}else{try{await P.postAddApi(g)}catch(d){console.log("post add api fail",d),s(!1);return}v.success(a("buComp.authManagement.addSuccess"))}t(),s(!1),i(!1)};return e.jsx(te,{width:"390px",classNames:{content:"h-460px",body:"h-330px overflow-auto pr-18px!"},title:a(m?"buComp.common.edit":"buComp.common.create"),open:l,onCancel:x,footer:e.jsxs(H,{justify:"flex-end",align:"center",gap:"small",children:[e.jsx(w,{onClick:x,children:a("buComp.common.cancel")}),e.jsx(w,{onClick:f,type:"primary",children:a("buComp.common.confirm")})]}),children:e.jsx(ae,{spinning:r,children:e.jsxs(h,{form:o,initialValues:m?void 0:Ha,layout:"vertical",children:[e.jsx(h.Item,{name:"postName",label:a("buComp.authManagement.postName"),rules:[{required:!0,message:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.postName",{lowerCase:!0})},{max:20,message:a("buComp.authManagement.lengthMax",{number:20})},{validator:se}],children:e.jsx(q,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.postName",{lowerCase:!0}),allowClear:!0})}),e.jsx(h.Item,{name:"postCode",label:a("buComp.authManagement.postIdentifier"),rules:[{required:!0,message:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.postIdentifier",{lowerCase:!0})},{max:20,message:a("buComp.authManagement.lengthMax",{number:20})},{validator:se},{validator:ze}],children:e.jsx(q,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.postIdentifier",{lowerCase:!0}),allowClear:!0})}),e.jsx(h.Item,{name:"deptTreePath",label:a("buComp.authManagement.department"),rules:[{required:!0,message:a("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+a("buComp.authManagement.department",{lowerCase:!0})}],children:e.jsx(ue,{options:b,placeholder:a("buComp.common.pleaseSelect",{addSpaceAfterEn:!0})+a("buComp.authManagement.department",{lowerCase:!0}),allowClear:!0,changeOnSelect:!0})}),e.jsx(h.Item,{name:"order",label:a("buComp.authManagement.order"),rules:[{required:!0,message:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.order",{lowerCase:!0})}],children:e.jsx(Re,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.order",{lowerCase:!0})})}),e.jsx(h.Item,{name:"remark",label:a("buComp.authManagement.postDesc"),rules:[{max:200,message:a("buComp.authManagement.lengthMax",{number:200})},{validator:se}],children:e.jsx(q,{placeholder:a("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+a("buComp.authManagement.postDesc",{lowerCase:!0}),allowClear:!0})})]})})})},qa=({mRef:p,onUpdate:t})=>{const a=window.$translation,[v,o]=n.useState(!1),[m,c]=n.useState(!1);n.useImperativeHandle(p,()=>({open(){o(!0)}}));const l=async()=>{console.log("submit"),t()},i=()=>{o(!1),c(!1)},r=b=>{console.log("change",b)},s=b=>{console.log("drop",b)};return e.jsx(te,{width:"390px",title:a("buComp.common.import"),open:v,onCancel:i,confirmLoading:m,footer:e.jsxs(H,{justify:"flex-end",align:"center",gap:"small",children:[e.jsx(w,{onClick:i,children:a("buComp.common.cancel")},"back"),e.jsx(w,{onClick:l,type:"primary",children:a("buComp.common.confirm")},"save")]}),children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"c-red-600",children:"*"}),e.jsx("span",{children:a("buComp.authManagement.onlyXls")}),e.jsx(w,{color:"primary",variant:"link",children:a("buComp.authManagement.downloadTemplate")})]}),e.jsx("div",{children:e.jsxs(ce.Dragger,{name:"file",maxCount:1,showUploadList:{showRemoveIcon:!0,showDownloadIcon:!0},accept:"application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:r,onDrop:s,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(pe,{})}),e.jsx("p",{children:a("buComp.authManagement.uploadTip")})]})})]})})},Wa=()=>{const{token:p}=le.useToken(),{t}=Q(),a=window.$modal,v=window.$message,[o,m]=n.useState(!1),[c]=h.useForm(),l={search:void 0},i=n.useRef({search:void 0}),[r,s]=n.useState([]),b=n.useRef(),z=n.useRef(),[S,N]=n.useState([]),[u,x]=n.useState({current:1,pageSize:10,total:0}),[f,C]=n.useState("calc(100% - 112px)"),[g,d]=n.useState(900),B=n.useRef(),y=n.useRef(),E={selectedRowKeys:r,onChange:R=>{s(R)},columnWidth:50},T=async(R,A)=>{m(!0);const j={pageNum:R,pageSize:A,...i.current},$=await P.postPageApi(j).catch(Y=>{console.log("get post list api fail",Y)}),{data:_,pageNum:U,pageSize:W,totalSize:X}=$||{};N((_==null?void 0:_.map((Y,J)=>({id:Y.id,index:(U-1)*W+J+1,postName:Y.postName,postIdentifier:Y.postCode,postDesc:Y.remark,department:Y.deptName,createTime:Y.createAt})))||[]),x({current:U||R,pageSize:W||A,total:X||0}),m(!1)},I=async R=>{try{await P.postDeleteApi({ids:[R]})}catch(A){console.log("delete post api failed",A);return}v.success(t("buComp.authManagement.deleteSuccess")),await T(S.length===1&&u.current>1?u.current-1:u.current,u.pageSize)},k=R=>{a.confirm({title:t("buComp.common.delete"),content:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:t("buComp.authManagement.confirmDelete",{addSpaceAfterEn:!0})+R.postName+"?"}),e.jsx("div",{style:{color:p.colorError},children:t("buComp.authManagement.deleteTips")})]}),okText:t("buComp.common.confirm"),cancelText:t("buComp.common.cancel"),okType:"primary",centered:!0,onOk:()=>I(R.id)})},K=async()=>{try{await P.postDeleteApi({ids:r})}catch(R){console.log("delete post api failed",R);return}v.success(t("buComp.authManagement.deleteSuccess")),await T(S.length===r.length&&u.current>1&&u.total<=u.current*u.pageSize?u.current-1:u.current,u.pageSize)},V=()=>{a.confirm({title:t("buComp.common.batchDelete"),content:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:t("buComp.authManagement.confirmDelete",{addSpaceAfterEn:!0})+t("buComp.authManagement.xPosts",{number:r.length})+"?"}),e.jsx("div",{style:{color:p.colorError},children:t("buComp.authManagement.deleteTips")})]}),okText:t("buComp.common.confirm"),cancelText:t("buComp.common.cancel"),okType:"primary",centered:!0,onOk:()=>K()})},D=[{title:t("buComp.authManagement.index"),dataIndex:"index",width:80},{title:t("buComp.authManagement.postName"),dataIndex:"postName"},{title:t("buComp.authManagement.postIdentifier"),dataIndex:"postIdentifier"},{title:t("buComp.authManagement.postDesc"),dataIndex:"postDesc"},{title:t("buComp.authManagement.department"),dataIndex:"department"},{title:t("buComp.authManagement.createTime"),dataIndex:"createTime",width:200,render:R=>fe(R,"YYYY-MM-DD HH:mm:ss")},{title:t("buComp.authManagement.action"),width:150,render:(R,A)=>e.jsx(he,{sameProps:{type:"text",size:"small"},tileCount:2,btnPermissions:["edit","delete"],btnList:[{title:t("buComp.common.edit"),resCode:"edit",icon:e.jsx(L,{name:"bi"}),onClick:()=>{var j;return(j=b.current)==null?void 0:j.open({id:A.id})}},{title:t("buComp.common.delete"),resCode:"delete",icon:e.jsx(L,{name:"shanchu"}),onClick:()=>k(A)}],record:A})}],O=()=>{c.resetFields(),i.current=l,T(1,u.pageSize),s([])},G=()=>{const R=c.getFieldsValue();i.current=R,T(1,u.pageSize)};return n.useEffect(()=>{T(1,10);const R=()=>{const A=setTimeout(()=>{var j;C(`calc(100% - ${((j=B==null?void 0:B.current)==null?void 0:j.clientHeight)||70}px)`),clearTimeout(A)},100)};return R(),window.addEventListener("resize",R),()=>window.removeEventListener("resize",R)},[]),n.useEffect(()=>{var R;d((((R=y.current)==null?void 0:R.clientHeight)||900)-50)},[f]),e.jsx(ae,{spinning:o,wrapperClassName:"spin-loading",children:e.jsxs("div",{className:"p-20px w-full h-full chint-theme-container",style:{backgroundColor:p.colorBgContainer},children:[e.jsx("div",{ref:B,children:e.jsxs(h,{form:c,initialValues:l,children:[e.jsxs(ge,{align:"middle",gutter:[24,12],wrap:!0,children:[e.jsx(ne,{span:6,children:e.jsx(h.Item,{name:"search",label:t("buComp.authManagement.postName"),children:e.jsx(q,{allowClear:!0,placeholder:t("buComp.common.pleaseInput",{addSpaceAfterEn:!0})+t("buComp.authManagement.postName",{lowerCase:!0})})})}),e.jsx(ne,{span:6,children:e.jsxs(xe,{size:16,children:[e.jsx(h.Item,{children:e.jsx(w,{type:"primary",onClick:G,icon:e.jsx(L,{name:"chaxun"}),children:t("buComp.common.search")})}),e.jsx(h.Item,{children:e.jsx(w,{onClick:O,icon:e.jsx(L,{name:"zhongzhi"}),children:t("buComp.common.reset")})})]})})]}),e.jsxs(H,{align:"center",wrap:!0,gap:"middle",children:[e.jsx(h.Item,{children:e.jsx(w,{type:"primary",onClick:()=>{var R;(R=b.current)==null||R.open({})},icon:e.jsx(L,{name:"xinzeng"}),children:t("buComp.common.create")})}),e.jsx(h.Item,{children:e.jsx(w,{type:"primary",onClick:V,disabled:r.length===0,danger:!0,icon:e.jsx(L,{name:"shanchu"}),children:t("buComp.common.batchDelete")})})]})]})}),e.jsxs("div",{className:"w-100%",style:{height:f,overflow:"auto"},children:[e.jsx(Ce,{style:{height:"calc(100% - 50px)"},columns:D,dataSource:S,rowSelection:E,rowKey:"id",scroll:{y:g,x:"900px"},pagination:!1,ref:y}),e.jsx(be,{className:"h-40px mt-10px",showQuickJumper:!0,showSizeChanger:!0,current:u.current,pageSize:u.pageSize,total:u.total,hideOnSinglePage:!1,pageSizeOptions:[10,20,30,50,100],onChange:T,showTotal:(R,A)=>t("common.paginationTotal",{rangeStart:A[0],rangeEnd:A[1],total:R}),align:"center"})]}),e.jsx(Ka,{mRef:b,onUpdate:O}),e.jsx(qa,{mRef:z,onUpdate:O})]})})},Ga=Te({getMessageApi:{method:"get",url:"/message/page"}},{baseURL:"/microApp",headers:{"Content-Type":"application/json"}}),$e={"message-center":"_message-center_ma3wh_1","message-table-search":"_message-table-search_ma3wh_17"},Ya=()=>{const p=na(),t=window.$translation,a=n.useRef(),[v,o]=n.useState(!1),m=[{label:t("buComp.message.unRead"),value:"0"},{label:t("buComp.message.read"),value:"1"}],c=[{title:t("buComp.common.serialNumber"),valueType:"index",width:80},{title:t("buComp.message.time"),dataIndex:"pushTime",hideInTable:!0,valueType:"dateRange"},{title:t("buComp.message.pushTime"),dataIndex:"time",ellipsis:!0,width:160,search:!1},{title:t("buComp.message.status"),dataIndex:"state",ellipsis:!0,width:120,valueType:"select",fieldProps:{options:m}},{title:t("buComp.message.messageType"),dataIndex:"type",valueType:"select",ellipsis:!0,width:120,search:!1,fieldProps:{options:[{label:t("buComp.message.alarmNotify"),value:"M001"}]}},{title:t("buComp.message.pushChannel"),dataIndex:"channel",valueType:"select",ellipsis:!0,width:120,search:!1,fieldProps:{options:[{label:t("buComp.message.internalMessage"),value:"C001"}]}},{title:t("buComp.message.description"),dataIndex:"description",ellipsis:!0,width:220,search:!1}];return e.jsx(sa,{className:"chint-theme-pro-table",actionRef:a,loading:v,columns:c,request:async l=>{const{current:i,pageSize:r,state:s,pushTime:b}=l||{};console.log("params",l),o(!0);const z=await Ga.getMessageApi({state:s,from:b==null?void 0:b[0],to:b==null?void 0:b[1],pageNum:i,pageSize:r},{}).catch(u=>{window.$message.error((u==null?void 0:u.message)||t("buComp.common.fdb.requestFailed"))});o(!1);const{data:S,totalSize:N}=z||{};return{data:S||[],success:!0,total:N}},scroll:{x:"max-content",y:p},rowKey:"id",search:{labelWidth:"auto",span:{xs:24,sm:12,md:12,lg:8,xl:8,xxl:6},className:$e["message-table-search"],collapsed:!1,collapseRender:()=>[],optionRender:({searchText:l,resetText:i},{form:r})=>[e.jsx(w,{icon:e.jsx(L,{name:"chaxun"}),type:"primary",onClick:()=>{r==null||r.submit()},children:l},"searchText"),e.jsx(w,{icon:e.jsx(L,{name:"zhongzhi"}),onClick:()=>{r==null||r.resetFields(),r==null||r.submit()},children:i},"resetText")]},options:!1,pagination:{showSizeChanger:!0,pageSizeOptions:[10,20,30,50,100],defaultCurrent:1,position:["bottomCenter"]}})},_a=()=>{const p=window.$translation,{useToken:t}=le,{token:a}=t(),[v,o]=n.useState("1"),m=[{label:p("buComp.message.messageRecord"),key:"1",children:e.jsx(Ya,{})}];return e.jsx("div",{className:`chint-theme-container ${$e["message-center"]}`,style:{backgroundColor:a.colorBgContainer},children:e.jsx(oa,{activeKey:v,onChange:o,items:m})})};function et(){var m;const{pageId:p}=la(),{loadComp:t,config:a}=window.usePageStore(c=>{const{selectPageItem:l}=c,i=c.page[(l==null?void 0:l.id)||""]||{};return{loadComp:c.loadComp,config:i.config}}),{breadcrumb:v}=ua(ra(c=>{const{layout:l,breadcrumb:i}=(c==null?void 0:c.appConfig)||{};return{layoutMode:l,pageLoading:c.pageLoading,breadcrumb:i}})),o=()=>{switch(p){case"personalCenter":return e.jsx(ka,{});case"userManagement":return e.jsx(Pa,{});case"roleManagement":return e.jsx(Fa,{});case"departmentManagement":return e.jsx(Ba,{});case"postManagement":return e.jsx(Wa,{});case"messageCenter":return e.jsx(_a,{});default:return e.jsx(da,{})}};return e.jsx(ca,{backend:ia,children:e.jsx(wa,{children:e.jsxs("div",{id:"editor",className:"w-100% h-100%",style:{height:`calc(100vh - ${v!==pa.ENABLE?"116px":"158px"})`,overflow:"auto",background:(m=a==null?void 0:a.props)==null?void 0:m.theme,...(a==null?void 0:a.style)||{}},children:[t&&e.jsx(ae,{className:"h-[calc(100vh-64px)] w-full grid place-items-center",spinning:t}),e.jsx(Pe.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:o()})]})})})}export{et as Component};
